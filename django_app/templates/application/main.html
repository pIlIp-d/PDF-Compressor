<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="static/style.css">
    <script src="static/dropzone/dropzone.js"></script>
    <link rel="stylesheet" href="static/dropzone/dropzone.css">

    <title>Croco-File-Crusher</title>
</head>

<body>

<!------------------------------------------------Headline------------------------------------------------------------->
<div id="header">
    <h1 id="heading"> Croco-File-Crusher </h1>
    <h2 id="subheading"> Want to get rid of redundant data? </h2>
</div>

<!-----------------------------------multiple options for compression-------------------------------------------------->

<form action="form_submit/" method="post" class="dropzone" id="my-dropzone">

    {% csrf_token %}
    <div id="compression_options">
        <label for="destination_file">
            Destination file:
            <input type="text" id="destination_file" name="destination_file" value="default">
        </label>

        <br>

        <label for="compression_mode">
            Compression mode:
            <select name="compression_mode" id="compression_mode">
                <option value="1">1: Extreme</option>
                <option value="2">2: Strong</option>
                <option value="3">3: Medium</option>
                <option value="4">4: Fast</option>
                <option selected="selected" value="5">5: Fastest</option>
            </select>
        </label>
        <br>

        <label for="default_pdf_dpi">
            Default DPI:
            <input type="number" name="default_pdf_dpi" id="default_pdf_dpi" value="400" step="10">
        </label>
        <br>

        <label for="force_ocr">
            Text recognition (OCR):
            <input type="checkbox" name="force_ocr" id="force_ocr">
        </label>
        <br>

        <label for="simple_and_lossless">
            Simple and lossless:
            <input type="checkbox" name="simple_and_lossless" id="simple_and_lossless">
        </label>
        <br>

        <label for="tesseract_language">
            Tesseract language:
            <select name="tesseract_language" id="tesseract_language">
                {% for lang in languages %}
                    <option value="{{ lang.value }}">{{ lang.text }}</option>
                {% endfor %}
            </select>
        </label>
        <br>
    </div>

</form>
<br>
<button id="submit-all">Submit all files</button>

<form method="get" action="">
   <button type="submit">Download!</button>
</form>

<button id="download_button" class="disabled">Download!</button><!-- css class 'disabled' -> render light gray until the class is 'enabled'-->

<!---------------------------image of the "Croco-File"----------------------------------------------------------------->


<img id="picture_of_croco_file"
     src="https://media.istockphoto.com/vectors/illustration-of-a-smiling-crocodile-vector-id1182596568?k=20&m=1182596568&s=170667a&w=0&h=KfqG2ZxPQONZplvl501LTh_b97yfhoOqRzDJeiXGgOY="
     alt="Image of a friendly looking Crocodile in a comic art style."/>
<br>

<!----------------------------------------------Linking_Git------------------------------------------------------------>

<footer id="github_project_link">
    Do you want to review the project? Visit <a href="https://github.com/pIlIp-d/PDF-Compressor/tree/dev">github.com/Croco-File-Crusher</a>
    to have a look at the Croco-File-Crusher.
</footer>

<script>

    MAIN_INTERVAL_TICK = 1000;

    Dropzone.options.myDropzone = {

        // Prevents Dropzone from uploading dropped files immediately
        autoProcessQueue: false,

        init: function () {
            const submitButton = document.querySelector("#submit-all");
            const myDropzone = this; // closure

            submitButton.addEventListener("click", function () {
                myDropzone.processQueue(); // Tell Dropzone to process all queued files.
                setInterval(main_interval, MAIN_INTERVAL_TICK);
            });

            // You might want to show the submit button only when
            // files are dropped here:
            this.on("added-file", function () {
                // Show submit button here and/or inform user to click it.
            });
            this.on("success", function (file, responseText) {   <!-- TODO responseText isn't used yet  -->
                console.log("ready with " + file);

            });

        }
    };

    function main_interval() {
        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState === 4 && this.status === 200) {
                let json_response = JSON.parse(this.response);
                if (json_response.finished)
                    activate_download_button();
            }
        }
        xhttp.open("GET", "../api/processing_of_queue_is_finished", true);
        xhttp.send();
    }

    function activate_download_button() {
        let download_button = document.getElementById("TODO");

        let xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            let json_response = JSON.parse(this.response);
            // download_button.href = json_response.download_file_path;
        }
        xhttp.open("GET", "../api/download_processed_file", true);
        xhttp.send();

    }
</script>

</body>